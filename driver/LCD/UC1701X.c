#include  <includes.h>
#include "font.c"
extern unsigned char TCP_Mode;
extern unsigned char WiFi_Status;



unsigned char BmpCode[10][72]=
{
  /*------------------------------------------------------------------------------
;  ??? / ?? : 0
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0x00,0x80,0xC0,0xE0,0xF0,0x70,0x70,0x70,0x70,0xF0,0xE0,0xE0,0xC0,0x00,
0x00,0x00,0x00,0xF0,0xFF,0xFF,0x0F,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x07,
0xFF,0xFF,0xF8,0x00,0x00,0x3F,0xFF,0xFF,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xC0,0xFF,0xFF,0x3F,0x00,0x00,0x00,0x01,0x07,0x0F,0x0F,0x1E,0x1C,0x1C,0x1C,
0x1C,0x1E,0x0F,0x07,0x03,0x01,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 1
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0xE0,0xE0,0x70,0x70,0x70,0x70,0xF0,0xF8,0xF8,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0x0E,0x0E,0x0E,0x0E,0x0E,0x0F,0x0F,
0x0F,0x0E,0x0E,0x0E,0x0E,0x0E,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 2
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0xC0,0xE0,0x70,0x70,0x38,0x38,0x38,0x38,0x38,0x78,0xF0,0xF0,0xE0,0x80,
0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0xFF,
0x7F,0x1F,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0x70,0x38,0x1C,0x1E,0x0F,0x07,
0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x0E,0x0F,0x0F,0x0F,0x0E,0x0E,0x0E,0x0E,0x0E,
0x0E,0x0E,0x0E,0x0E,0x0E,0x0E,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 3
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0xC0,0xE0,0xE0,0x70,0x70,0x70,0x70,0x70,0xF0,0xE0,0xE0,0xC0,0x00,0x00,
0x00,0x00,0x00,0x00,0x01,0x00,0x80,0x80,0x80,0x80,0x80,0xC0,0xC0,0xE1,0x7F,0x3F,
0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x03,0x03,0x03,0x03,0x07,0x06,
0x0E,0xFE,0xFC,0xF0,0x00,0x00,0x00,0x07,0x0E,0x0E,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,
0x1E,0x0E,0x0F,0x07,0x03,0x01,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 4
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xF0,0x78,0xF8,0xF8,0xF8,0x00,
0x00,0x00,0x00,0x00,0x00,0xC0,0xE0,0xF0,0x3C,0x1E,0x07,0x03,0x01,0x00,0xFF,0xFF,
0xFF,0x00,0x00,0x00,0x38,0x3E,0x3F,0x3F,0x39,0x38,0x38,0x38,0x38,0x38,0x38,0x38,
0xFF,0xFF,0xFF,0x38,0x38,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x0F,0x0F,0x0F,0x00,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 5
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0x00,0xF0,0xF0,0xF0,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x00,
0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xE0,0xE0,0xE0,0xE0,0xE0,0xC0,0xC0,0x80,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,
0x87,0xFF,0xFF,0xFC,0x00,0x00,0x00,0x00,0x07,0x0E,0x1E,0x1C,0x1C,0x1C,0x1C,0x1C,
0x1E,0x0E,0x0F,0x07,0x03,0x00,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 6
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0xE0,0x70,0x70,0x70,0x70,0x70,0x70,0xE0,0x00,
0x00,0x00,0x00,0xE0,0xFC,0xFF,0x0F,0x83,0xC1,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xC0,
0x80,0x00,0x00,0x00,0x00,0x3F,0xFF,0xFF,0x83,0x01,0x01,0x00,0x00,0x00,0x00,0x00,
0x01,0x83,0xFF,0xFF,0xFC,0x00,0x00,0x00,0x01,0x07,0x0F,0x0F,0x1E,0x1C,0x1C,0x1C,
0x1C,0x1E,0x0E,0x0F,0x07,0x03,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 7
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0x70,0xF0,0xF0,0xF0,0x70,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xF8,0xFF,0x7F,0x0F,
0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xF8,0xFE,0x3F,0x0F,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x1E,0x1F,0x0F,0x01,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 8
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0x80,0xE0,0xF0,0xF0,0x78,0x38,0x38,0x38,0x38,0x78,0xF0,0xE0,0xC0,0x00,
0x00,0x00,0x00,0x00,0x07,0x1F,0x3F,0xF8,0xF0,0xE0,0xC0,0xE0,0xF0,0xF8,0x3F,0x1F,
0x07,0x00,0x00,0x00,0x00,0xF8,0xFE,0xFF,0x87,0x03,0x01,0x01,0x00,0x01,0x01,0x03,
0x87,0xFF,0xFE,0xF8,0x00,0x00,0x00,0x00,0x03,0x07,0x07,0x0F,0x0E,0x0E,0x0E,0x0E,
0x0E,0x0F,0x07,0x07,0x03,0x00,0x00,0x00,
/*------------------------------------------------------------------------------
;  ??? / ?? : 9
;  ?×?(??): 18×32
------------------------------------------------------------------------------*/
0x00,0x00,0xC0,0xE0,0xF0,0x70,0x38,0x38,0x38,0x38,0x78,0x70,0xF0,0xE0,0x80,0x00,
0x00,0x00,0x00,0x3F,0xFF,0xFF,0xC1,0x80,0x00,0x00,0x00,0x00,0x00,0x80,0xC1,0xFF,
0xFF,0xFE,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x07,0x07,0x07,0x07,0x03,0xC3,
0xF1,0xFF,0x7F,0x07,0x00,0x00,0x00,0x00,0x07,0x0F,0x0E,0x0E,0x0E,0x0E,0x0E,0x07,
0x07,0x03,0x01,0x00,0x00,0x00,0x00,0x00,


};

void UC1701X_PORT_INIT()
{
	
		GPIO_InitTypeDef GPIO_InitStructure;
		RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA|RCC_APB2Periph_GPIOB, ENABLE);
		GPIO_InitStructure.GPIO_Pin = LCD_CLK_PIN;                                              
    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;
    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_Init(LCD_CLK_BASE, &GPIO_InitStructure);
	
		GPIO_InitStructure.GPIO_Pin = LCD_SDA_PIN;                                              
    GPIO_Init(LCD_SDA_BASE, &GPIO_InitStructure);
	
		GPIO_InitStructure.GPIO_Pin = LCD_RS_PIN;                                              
    GPIO_Init(LCD_RS_BASE, &GPIO_InitStructure);
	
		GPIO_InitStructure.GPIO_Pin = LCD_RST_PIN;                                              
    GPIO_Init(LCD_RST_BASE, &GPIO_InitStructure);
	
		GPIO_InitStructure.GPIO_Pin = LCD_CS_PIN;    //TXD                                           
    GPIO_Init(LCD_CS_BASE, &GPIO_InitStructure);
	
		GPIO_InitStructure.GPIO_Pin = LCD_BLACKLED_PIN;    //RXD                                         
    GPIO_Init(LCD_BLACKLED_BASE, &GPIO_InitStructure);
	
}


void Transfer_command(int data1)
{
    char i;
    LCD_CS_LO
    LCD_RS_LO
    for(i=0;i<8;i++)
    {
        LCD_CLK_LO
        if(data1&0x80) LCD_SDA_HI
        else LCD_SDA_LO
   //    OSTimeDly(2);
        LCD_CLK_HI
    //    OSTimeDly(2);
        data1=data1<<1;
    }
}

void Transfer_data(int data1)
{
    char i;
    LCD_CS_LO
    LCD_RS_HI
    for(i=0;i<8;i++)
    {
        LCD_CLK_LO
        if(data1&0x80) LCD_SDA_HI
        else LCD_SDA_LO
        LCD_CLK_HI
        data1=data1<<1;
    }
}
void Initial_Lcd()
{
    UC1701X_PORT_INIT();
    LCD_RST_LO //Reset the chip when reset=0
    OSTimeDly(OS_TICKS_PER_SEC/10 );
    LCD_RST_HI
    OSTimeDly(OS_TICKS_PER_SEC/10);
    Transfer_command(0xe2); /*???*/
    Transfer_command(0x2c); /*????1*/
    Transfer_command(0x2e); /*????2*/
    Transfer_command(0x2f); /*????3*/
    Transfer_command(0x23); /*?????,?????20~27*/
    Transfer_command(0x81); /*?????*/
    Transfer_command(0x28); /*???????,?????0~63*/
    Transfer_command(0xa2); /*1/9 ???(bias)*/
    Transfer_command(0xc8); /*?????:????*/
    Transfer_command(0xa0); /*?????:????*/
    Transfer_command(0xaf); /*???*/
		LCD_BLACKLED_ON
}
//===============clear

void clear_screen(unsigned char x_start,unsigned char y_start,unsigned char x_size,unsigned char y_size,unsigned char Color)
{
    unsigned char i,j;
    for(i=(y_start>>3);i<(y_start>>3)+(y_size>>3);i++)
    {
        LCD_CS_LO
        Transfer_command(0xb0+i);
        Transfer_command(0x10+(x_start>>4));
        Transfer_command(0x00+(x_start&0x0f));
        for(j=0;j<x_size;j++)
        {
        Transfer_data(Color);
        }
    }
}


void DisplayClearAll(void)
{
	clear_screen(0,0,128,64,WHILE);
}

void DisplayGraphic1()
{
    unsigned char *address; //define pointer
    int i,j;
//    address=graphic1; //data pointer:point to "graphic[]",one-dimensional array
    for(i=0;i<8;i++)
    {
        LCD_CS_LO
        Transfer_command(0xb0+i); //set page address,
        Transfer_command(0x10);
        Transfer_command(0x00);
        for(j=0;j<128;j++)
        {
        Transfer_data(0XF0);
        address++;
        }
    }
}


void DisplayCode(unsigned char x_start, unsigned char y_start,unsigned char x_size, unsigned char y_size, const unsigned char *Data)
{
	unsigned char i,j;
      for(i=(y_start>>3);i<(y_start>>3)+(y_size>>3);i++)
    {
        LCD_CS_LO
        Transfer_command(0xb0+i); //set page address,
        Transfer_command(0x10+(x_start>>4));
        Transfer_command(0x00+(x_start&0x0f));
        for(j=0;j<x_size;j++)
        {
        Transfer_data(*Data);
        Data++;
        }
    }
}

void displayChar(unsigned char x_start, unsigned char y_start,unsigned char iChar)
{
	unsigned char iCnt=0;
	iCnt=Get_Font_Size(iChar);
	DisplayCode(x_start,y_start,iCnt,16,Font_Points[iChar]);
}

void displayString(unsigned char x_start, unsigned char y_start,const unsigned char *iString)
{
	unsigned char i = 0;
	unsigned char iCnt=0;
	clear_screen(x_start,y_start,128-x_start,16,WHILE);
	while(iString[i]!='\0')
	{
		iCnt=Get_Font_Size(iString[i]);
		if((x_start+iCnt)>=128)
		{
			y_start += 16;
			x_start = 0;
		}
		DisplayCode(x_start,y_start,iCnt,16,Font_Points[iString[i]]);
		i++;
		x_start+=iCnt;
	}
}

void DisplayNum(unsigned char x_start, unsigned char y_start,unsigned char num)
{
	DisplayCode(x_start,y_start,18,32,BmpCode[num]);
}

